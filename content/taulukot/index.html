<!DOCTYPE HTML>
<html>

<head>
	<meta http-equiv="Content-Type" tab-content="text/html; charset=UTF-8" />
	<meta charset="UTF-8">
	<title>Abitti-taulukot / Abitti-tabeller</title>
	<link rel="stylesheet" href="../../common/css/tab.css" type="text/css" media="screen" />
	<script type="text/javascript" src="../../common/js/jquery-2.2.0.min.js"></script>
	<script type="text/javascript" src="../../common/clipboard.min.js"></script>
	<script type="text/javascript" src="../../common/js/activetab.js"></script>
	<script type="text/javascript">
		// Handles for subpage initialisation functions
		var subpage_init = {};

		function activate_copy_to_clipboard() {
			$(".special-key").unbind("click");

			// Activate Digabi-specific copy feature
			if (typeof (sharedclass) == 'object') {
				// This is executed inside digabi-koe-browser.py
				$(".special-key").click(function () {
					sharedclass.copy_to_clipboard($(this).text());
				});
			}
			else {
				// This is executed in regular browser (uses clipboard.js)
				$(".special-key").click(function () {
					clipboard.copy($(this).text()).then(
						function () {
							console.log("Copied to clipboard!");
						},
						function (err) {
							alert("Copying to clipboard is not supported on your browser.");
							console.log("Copying to clipboard failed:", err);
						});
				});
			}
		}

		function write_to_stdout(message) {
			if (typeof (sharedclass) == 'object') {
				// This is executed inside digabi-koe-browser.py
				sharedclass.write_to_stdout(message);
			}
			else {
				// This is executed in regular browser (uses clipboard.js)
				console.log(message);
			}
		}

		function set_video_url(language) {
			$(".helpvideo").each(function () {
				var src = language + "/" + $(this).attr('data-src');
				$(this).attr('src', src);
			});
		}

		function set_language(language) {
			if (language.toLowerCase() == "fi") {
				console.log("Language set to Finnish");
				$(".fi").css("display", "t");
				$(".sv").css("display", "none");
			}
			else if (language.toLowerCase() == "sv") {
				console.log("Language set to Swedish");
				$(".fi").css("display", "none");
				$(".sv").css("display", "");
			}
			else {
				console.log("Unknown language: " + language);
			}
		}

		function init_subpage(page_tag) {
			if (typeof (subpage_init[page_tag]) == 'function') {
				console.log('Running sub-page initialisation for ' + page_tag);
				subpage_init[page_tag]();
			}
			else {
				console.log('Tried to run sub-page initialisation for ' + page_tag + ' but is is not defined');
			}
		}

		// Lazy load tables
		function changePageTo(subject, currentLanguage) {
			if ($("#tab-" + subject).children().length === 0) {
				$("#tab-" + subject).load("tab-" + subject + ".html", function () { set_language(currentLanguage) })
			}
		}

		// Math-copying related functionality
		function createMathImg(latex) {
			console.log('createEq')
			const img = document.createElement('img')
			img.setAttribute('alt', latex)
			var hostname = document.location.hostname
			var baseUrl = hostname === 'localhost' || hostname == '' ? '' : 'https://math-demo.abitti.fi'
			img.setAttribute('src', baseUrl + '/math.svg?latex=' + encodeURIComponent(latex))
			document.body.appendChild(img)
			return img
		}

		function selectElementContents(el) {
			const range = document.createRange()
			range.selectNode(el)
			const sel = window.getSelection()
			sel.removeAllRanges()
			sel.addRange(range)
		}

		$(document).ready(function () {
			// Set current language accoring to various suggestions
			var request = window.location.href;
			var lang = "fi";
			var defaultPage = "math"

			if (request.lastIndexOf('?') > -1) {
				var param = request.slice(request.lastIndexOf('?') + 1);
				lang = param.toLowerCase();
			}

			if (request.indexOf('index-fi') > -1) {
				lang = 'fi';
			}
			if (request.indexOf('index-sv') > -1) {
				lang = 'sv';
			}

			// Default init
			changePageTo(defaultPage, lang)

			// Initialise ActiveTab navigation
			var main_tabs = Object.create(ActiveTab);
			main_tabs.classPrefix = 'tab';
			main_tabs.tabNames = ["math", "physics", "chemistry", "help"];

			// Execute special initialisation when "tables" tab is activated
			main_tabs.activeTabInitialise = {
				'math': function () { write_to_stdout('math'); changePageTo("math", lang); setSameHeights(); },
				'physics': function () { write_to_stdout('physics'); changePageTo("physics", lang); setSameHeights(); },
				'chemistry': function () { write_to_stdout('chemistry'); changePageTo("chemistry", lang); setSameHeights(); },
				'help': function () { write_to_stdout('tables_to_help'); window.open('../index.html?' + lang); }
			};
			main_tabs.activateTabs();

			$('#loading').hide();
			$('body').on('click', 'svg', e => {
				var latex = $(e.target).find('title').text()
				if (!latex) {
					return
				}
				console.log(latex)
				$(e.target)
					.css({ borderColor: "#707070", borderStyle: "solid", borderWidth: "2px" })
				const el = createMathImg(latex)
				selectElementContents(el)
				e.preventDefault()
				document.execCommand('copy')
				document.body.removeChild(el)
				$("#copying").show().fadeOut(2000)
			})
		});
	</script>
</head>

<body>

	<div id="tab-container">
		<div id="tab-menu">
			<a id="math-fi" class="tab-menu-option fi tab-menu-option-active">Matematiikka</a>
			<a id="math-sv" class="tab-menu-option sv tab-menu-option-active">Matematik</a>
			<a id="physics-fi" class="tab-menu-option fi">Fysiikka</a>
			<a id="physics-sv" class="tab-menu-option sv">Fysik</a>
			<a id="chemistry-fi" class="tab-menu-option fi">Kemia</a>
			<a id="chemistry-sv" class="tab-menu-option sv">Kemi</a>
			<a id="help-fi" class="tab-menu-option fi">Apua</a>
			<a id="help-sv" class="tab-menu-option sv">Hjälp</a>
		</div>

		<div id="tab-math" class="tab-content active">
		</div>
		<div id="tab-physics" class="tab-content">
		</div>
		<div id="tab-chemistry" class="tab-content">
		</div>
		<div id="tab-help" class="tab-content">
		</div>
	</div>
	<div id="loading">
		<div id="loading-text"><span class="fi">Ladataan...</span><span class="sv">Laddas...</span></div>
	</div>
	<div id="copying">
		<div id="copy-text"><span class="fi">Kaava kopioitu leikepöydälle.</span><span class="sv">Copied...</span></div>
	</div>
	<script async type="text/javascript" src="../../common/js/sameHeights.js"></script>
</body>

</html>